# Contaminaci칩n de Par치metros

## Contaminaci칩n de Par치metros

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

## Visi칩n General de la Contaminaci칩n de Par치metros HTTP (HPP)

La Contaminaci칩n de Par치metros HTTP (HPP) es una t칠cnica donde los atacantes manipulan par치metros HTTP para cambiar el comportamiento de una aplicaci칩n web de maneras no intencionadas. Esta manipulaci칩n se realiza a침adiendo, modificando o duplicando par치metros HTTP. El efecto de estas manipulaciones no es directamente visible para el usuario, pero puede alterar significativamente la funcionalidad de la aplicaci칩n en el lado del servidor, con impactos observables en el lado del cliente.

### Ejemplo de Contaminaci칩n de Par치metros HTTP (HPP)

Una URL de transacci칩n de una aplicaci칩n bancaria:

* **URL Original:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000`

Al insertar un par치metro `from` adicional:

* **URL Manipulada:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000&from=accountC`

La transacci칩n puede ser incorrectamente cargada a `accountC` en lugar de `accountA`, mostrando el potencial de HPP para manipular transacciones u otras funcionalidades como restablecimientos de contrase침a, configuraciones de 2FA o solicitudes de claves API.

#### **An치lisis de Par치metros Espec칤fico de Tecnolog칤a**

* La forma en que se analizan y priorizan los par치metros depende de la tecnolog칤a web subyacente, afectando c칩mo se puede explotar HPP.
* Herramientas como [Wappalyzer](https://addons.mozilla.org/en-US/firefox/addon/wappalyzer/) ayudan a identificar estas tecnolog칤as y sus comportamientos de an치lisis.

### Explotaci칩n de HPP en PHP

**Caso de Manipulaci칩n de OTP:**

* **Contexto:** Se explot칩 un mecanismo de inicio de sesi칩n que requer칤a una Contrase침a de Un Solo Uso (OTP).
* **M칠todo:** Al interceptar la solicitud de OTP utilizando herramientas como Burp Suite, los atacantes duplicaron el par치metro `email` en la solicitud HTTP.
* **Resultado:** El OTP, destinado al correo electr칩nico inicial, fue enviado en su lugar a la segunda direcci칩n de correo electr칩nico especificada en la solicitud manipulada. Este fallo permiti칩 el acceso no autorizado al eludir la medida de seguridad prevista.

Este escenario destaca una omisi칩n cr칤tica en el backend de la aplicaci칩n, que proces칩 el primer par치metro `email` para la generaci칩n de OTP, pero utiliz칩 el 칰ltimo para la entrega.

**Caso de Manipulaci칩n de Clave API:**

* **Escenario:** Una aplicaci칩n permite a los usuarios actualizar su clave API a trav칠s de una p치gina de configuraci칩n de perfil.
* **Vector de Ataque:** Un atacante descubre que al a침adir un par치metro `api_key` adicional a la solicitud POST, puede manipular el resultado de la funci칩n de actualizaci칩n de la clave API.
* **T칠cnica:** Utilizando una herramienta como Burp Suite, el atacante elabora una solicitud que incluye dos par치metros `api_key`: uno leg칤timo y uno malicioso. El servidor, procesando solo la 칰ltima ocurrencia, actualiza la clave API al valor proporcionado por el atacante.
* **Resultado:** El atacante obtiene control sobre la funcionalidad API de la v칤ctima, potencialmente accediendo o modificando datos privados sin autorizaci칩n.

Este ejemplo subraya a칰n m치s la necesidad de un manejo seguro de par치metros, especialmente en funciones tan cr칤ticas como la gesti칩n de claves API.

### An치lisis de Par치metros: Flask vs. PHP

La forma en que las tecnolog칤as web manejan par치metros HTTP duplicados var칤a, afectando su susceptibilidad a ataques HPP:

* **Flask:** Adopta el primer valor de par치metro encontrado, como `a=1` en una cadena de consulta `a=1&a=2`, priorizando la instancia inicial sobre duplicados posteriores.
* **PHP (en Apache HTTP Server):** Por el contrario, prioriza el 칰ltimo valor de par치metro, optando por `a=2` en el ejemplo dado. Este comportamiento puede facilitar inadvertidamente los exploits de HPP al honrar el par치metro manipulado por el atacante sobre el original.

## Contaminaci칩n de par치metros por tecnolog칤a

Los resultados fueron tomados de [https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89](https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89)

### PHP 8.3.11 Y Apache 2.4.62 <a href="#id-9523" id="id-9523"></a>

<figure><img src="../.gitbook/assets/image (1255).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*l_Pf2JNCYhmfAvfk7UTEbQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*l_Pf2JNCYhmfAvfk7UTEbQ.jpeg</a></p></figcaption></figure>

1. Ignorar cualquier cosa despu칠s de %00 en el nombre del par치metro.
2. Manejar name\[] como un array.
3. \_GET no significa m칠todo GET.
4. Preferir el 칰ltimo par치metro.

### Ruby 3.3.5 y WEBrick 1.8.2

<figure><img src="../.gitbook/assets/image (1257).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*kKxtZ8qEmgTIMS81py5hhg.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*kKxtZ8qEmgTIMS81py5hhg.jpeg</a></p></figcaption></figure>

1. Utiliza los delimitadores & y ; para dividir par치metros.
2. No reconoce name[].
3. Prefiere el primer par치metro.

### Spring MVC 6.0.23 Y Apache Tomcat 10.1.30 <a href="#dd68" id="dd68"></a>

<figure><img src="../.gitbook/assets/image (1258).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*llG22MF1gPTYZYFVCmCiVw.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*llG22MF1gPTYZYFVCmCiVw.jpeg</a></p></figcaption></figure>

1. POST RequestMapping == PostMapping & GET RequestMapping == GetMapping.
2. POST RequestMapping & PostMapping reconocen name[].
3. Preferir name si name Y name[] existen.
4. Concatenar par치metros e.g. first,last.
5. POST RequestMapping & PostMapping reconocen par치metros de consulta con Content-Type.

### **NodeJS** 20.17.0 **Y** Express 4.21.0 <a href="#id-6d72" id="id-6d72"></a>

<figure><img src="../.gitbook/assets/image (1259).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JzNkLOSW7orcHXswtMHGMA.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JzNkLOSW7orcHXswtMHGMA.jpeg</a></p></figcaption></figure>

1. Reconoce name[].
2. Concatenar par치metros e.g. first,last.

### GO 1.22.7 <a href="#id-63dc" id="id-63dc"></a>

<figure><img src="../.gitbook/assets/image (1260).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NVvN1N8sL4g_Gi796FzlZA.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NVvN1N8sL4g_Gi796FzlZA.jpeg</a></p></figcaption></figure>

1. NO reconoce name[].
2. Preferir el primer par치metro.

### Python 3.12.6 Y Werkzeug 3.0.4 Y Flask 3.0.3 <a href="#b853" id="b853"></a>

<figure><img src="../.gitbook/assets/image (1261).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Se5467PFFjIlmT3O7KNlWQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Se5467PFFjIlmT3O7KNlWQ.jpeg</a></p></figcaption></figure>

1. NO reconoce name[].
2. Preferir el primer par치metro.

### Python 3.12.6 Y Django 4.2.15 <a href="#id-8079" id="id-8079"></a>

<figure><img src="../.gitbook/assets/image (1262).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rf38VXut5YhAx0ZhUzgT8Q.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rf38VXut5YhAx0ZhUzgT8Q.jpeg</a></p></figcaption></figure>

1. NO reconoce name[].
2. Preferir el 칰ltimo par치metro.

### Python 3.12.6 Y Tornado 6.4.1 <a href="#id-2ad8" id="id-2ad8"></a>

<figure><img src="../.gitbook/assets/image (1263).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*obCn7xahDc296JZccXM2qQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*obCn7xahDc296JZccXM2qQ.jpeg</a></p></figcaption></figure>

1. NO reconoce name[].
2. Preferir el 칰ltimo par치metro.

## Referencias

* [https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654](https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654)
* [https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution](https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution)
* [https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89](https://medium.com/@0xAwali/http-parameter-pollution-in-2024-32ec1b810f89)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}

{% hint style="success" %}
Aprende y practica Hacking en AWS:<img src="../.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/arte.png" alt="" data-size="line">\
Aprende y practica Hacking en GCP: <img src="../.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Apoya a HackTricks</summary>

* Revisa los [**planes de suscripci칩n**](https://github.com/sponsors/carlospolop)!
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Comparte trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>
{% endhint %}
